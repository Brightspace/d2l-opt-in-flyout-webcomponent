<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../lang/ar.html">
<link rel="import" href="../lang/de.html">
<link rel="import" href="../lang/en.html">
<link rel="import" href="../lang/es.html">
<link rel="import" href="../lang/fr.html">
<link rel="import" href="../lang/ja.html">
<link rel="import" href="../lang/ko.html">
<link rel="import" href="../lang/nb.html">
<link rel="import" href="../lang/nl.html">
<link rel="import" href="../lang/pt.html">
<link rel="import" href="../lang/sv.html">
<link rel="import" href="../lang/tr.html">
<link rel="import" href="../lang/zh-TW.html">
<link rel="import" href="../lang/zh.html">

<script>
	window.D2L = window.D2L || {};
	window.D2L.PolymerBehaviors = window.D2L.PolymerBehaviors || {};
	window.D2L.PolymerBehaviors.OptInFlyout = window.D2L.PolymerBehaviors.OptInFlyout || {};
	
	/** @polymerBehavior D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior */
	D2L.PolymerBehaviors.OptInFlyout.TranslateBehaviorImpl = {
		
		properties: {
			
			_fallbackLangTag: {
				type: String,
				value: function() {
					var rootElement = window.document.documentElement;
					var fallbackLanguage = rootElement.getAttribute('data-lang-default') || 'en';
					return fallbackLanguage.toLowerCase();
				}
			},
			
			_langTag: {
				type: String,
				value: function() {
					var rootElement = window.document.documentElement;
					var fallbackLanguage = rootElement.getAttribute('data-lang-default') || 'en';
					var desiredLanguage = rootElement.getAttribute('lang') || fallbackLanguage;
					return desiredLanguage.toLowerCase();
				}
			},
			
			translate: {
				type: Function,
				computed: '_getTranslateFunction(_langTag,_fallbackLangTag)'
			}
		},
		
		_getTranslateFunction: function( __langTag, __fallbackLangTag ) {
			var tryGetTerm = function( langPack, langTerm ) {
				var langPath = langTerm.split( '.' );
				langPath.forEach( function( langPart ) {
					if( !langPack || typeof langPack !== 'object' ) {
						return null;
					}
					langPack = langPack[langPart];
				});
				
				if( typeof langPack !== 'string' ) {
					return null;
				}
				
				return langPack;
			};
			
			return function( langTag, fallbackLangTag, langTerm ) {
				while( true ) {
					var languagePack = this['translations_' + langTag];
					var translation = tryGetTerm( languagePack, langTerm ); 
					if( translation ) {
						return translation;
					} else if( langTag.indexOf( '-' ) > -1 ) {
						langTag = langTag.substring( 0, langTag.indexOf( '-' ) );
					} else if( fallbackLangTag ) {
						langTag = fallbackLangTag;
						fallbackLangTag = null;
					} else if( langTag !== 'en' ) {
						langTag = 'en';
					} else {
						return null;
					}
				}
			}.bind( this, __langTag, __fallbackLangTag );
		}
		
	};
	
	/** @polymerBehavior */
	D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior = [
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehaviorImpl,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangArBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangDeBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangEnBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangEsBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangFrBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangJaBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangKoBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangNbBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangNlBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangPtBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangSvBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangTrBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangZhBehavior,
		D2L.PolymerBehaviors.OptInFlyout.TranslateBehavior.LangZhTwBehavior
	];
</script>