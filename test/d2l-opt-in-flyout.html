<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

		<title>d2l-opt-in-flyout test</title>

		<script src="../../webcomponentsjs/webcomponents-lite.js"></script>
		<script src="../../web-component-tester/browser.js"></script>
		<script src="../../iron-test-helpers/mock-interactions.js"></script>

		<link rel="import" href="../d2l-opt-in-flyout.html">
	</head>
	<body>
		<test-fixture id="FlyoutEmptyFixture">
			<template>
				<d2l-opt-in-flyout
					open
				></d2l-opt-in-flyout>
			</template>
		</test-fixture>
		<test-fixture id="FlyoutPropertiesFixture">
			<template>
				<d2l-opt-in-flyout
					open
					title="Flyout Demo"
					details="This is a demo of the opt-in flyout."
					tab-position="right"
					tutorial-link="https://www.example.com#tutorial"
					help-docs-link="https://www.example.com#documentation"
				></d2l-opt-in-flyout>
			</template>
		</test-fixture>
		<test-fixture id="FlyoutEmptyClosedFixture">
			<template>
				<d2l-opt-in-flyout
				></d2l-opt-in-flyout>
			</template>
		</test-fixture>
		<script>
			describe('<d2l-opt-in-flyout>', function() {
				describe('when properties use default values', function() {

					var flyout, innerFlyout;

					beforeEach(function() {
						flyout = fixture('FlyoutEmptyFixture');
						innerFlyout = flyout.$$('flyout-impl');
					});

					it('should contain opt in message', function() {
						var message = innerFlyout.$$('#description');
						expect(message.textContent).to.contain('turned off');
					});

					it('should not contain', function() {
						var title = innerFlyout.$$('#title');
						expect(title.textContent).to.equal(' ');
					});

					it('should not contain details', function() {
						var details = innerFlyout.$$('.flyout-details');
						expect(details.hidden).to.be.true;
					});

					it.skip('should not contain tutorial link or help documentation if not set', function() {
						var tutorial = innerFlyout.$$('.flyout-tutorial');
						expect(tutorial.textContent).to.equal('');
					});
				});

				describe('when properties are specified', function() {
					var flyout, innerFlyout;

					beforeEach(function() {
						flyout = fixture('FlyoutPropertiesFixture');
						innerFlyout = flyout.$$('flyout-impl');
					});

					it('should contain opt in message', function() {
						var message = innerFlyout.$$('#description');
						expect(message.textContent).to.contain('turned off');
					});

					it('should contain title', function() {
						var title = innerFlyout.$$('#title');
						expect(title.textContent).to.equal('Flyout Demo');
					});

					it('should reflect title attribute to property', function() {
						var newTitle = 'new title';

						flyout.setAttribute('title', newTitle);
						expect(flyout.title).to.equal(newTitle);
						var title = flyout.$$('flyout-impl').$$('#title');
						expect(title.textContent).to.equal(newTitle);
					});

					it('should contain details', function() {
						var details = innerFlyout.$$('.flyout-details');
						expect(details.hidden).to.be.false;
						expect(details.textContent).to.contain('This is a demo of the opt-in flyout');
					});

					it.skip('should contain tutorial link when property is set', function() {

					});

					it.skip('should help documentation link', function() {

					});

					it.skip('should contain only tutorial specific text when only tutorial link specified', function() {

					});

					it.skip('should contain only help documentation specific text when only help link specified', function() {

					});

					it('should contain enable button', function() {
						var button = innerFlyout.$$('d2l-button[primary]');
						expect(button.textContent).to.equal('Turn it on');
						expect(button).to.exist;
					});

					it('should contain leave it off button', function() {
						var button = innerFlyout.$$('d2l-button:not([primary])');
						expect(button.textContent).to.equal('Leave it off');
						expect(button).to.exist;
					});

					it('should fire opt-in event when enable button clicked', function(done) {
						flyout.addEventListener('opt-in', function() {
							done();
						});

						var button = innerFlyout.$$('d2l-button[primary]');
						MockInteractions.tap(button);
					});

					it('should fire flyout-closed event when enable button clicked', function(done) {
						flyout.addEventListener('flyout-closed', function() {
							done();
						});

						var button = innerFlyout.$$('d2l-button[primary]');
						MockInteractions.tap(button);
					});

					it('should fire opt-out event when leave it disabled button clicked', function(done) {
						flyout.addEventListener('opt-out', function() {
							done();
						});

						var button = innerFlyout.$$('d2l-button:not([primary])');
						MockInteractions.tap(button);
					});

					it('should fire flyout-closed event when leave it disabled button clicked', function(done) {
						flyout.addEventListener('flyout-closed', function() {
							done();
						});

						var button = innerFlyout.$$('d2l-button:not([primary])');
						MockInteractions.tap(button);
					});

					it('should fire flyout-closed event when tab clicked', function(done) {
						flyout.addEventListener('flyout-closed', function() {
							done();
						});

						var tab = innerFlyout.$$('.flyout-tab');
						MockInteractions.tap(tab);
					});
				});

				describe('when flyout is closed', function() {

					var flyout, innerFlyout;

					beforeEach(function() {
						flyout = fixture('FlyoutEmptyClosedFixture');
						innerFlyout = flyout.$$('flyout-impl');
					});

					it('should fire flyout-opened event when tab clicked', function(done) {
						flyout.addEventListener('flyout-opened', function() {
							done();
						});

						var tab = innerFlyout.$$('.flyout-tab');
						MockInteractions.tap(tab);
					});
				});
			});
		</script>
	</body>
</html>
